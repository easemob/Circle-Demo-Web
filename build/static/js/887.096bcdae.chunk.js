"use strict";(self.webpackChunkcircle=self.webpackChunkcircle||[]).push([[887],{8887:function(e,n,t){t.r(n),t.d(n,{default:function(){return Q}});var s=t(2791),c=t(6871),a="index_contentWrap__yXysN",r="index_sideBarWrap__850iF",i="index_title__CjdD8",o="index_icon__kjo7s",l="index_text__yFIwT",d="index_menuList__fui55",u="index_menuItem__55Mw-",_=t(1091),x=t(184),f=function(){return(0,x.jsxs)("div",{className:r,children:[(0,x.jsxs)("div",{className:i,children:[(0,x.jsx)(_.Z,{name:"square_4",size:"24px",iconClass:o}),(0,x.jsx)("span",{className:l,children:"\u5e7f\u573a"})]}),(0,x.jsx)("div",{className:d,children:(0,x.jsxs)("div",{className:u,children:[(0,x.jsx)(_.Z,{name:"point_9",size:"24px",iconClass:o}),(0,x.jsx)("span",{className:l,children:"\u5168\u90e8\u5206\u7c7b"})]})})]})},m=(0,s.memo)(f),v=t(9439),h="index_container__IAJ0-",j="index_title__KYTEV",p="index_welcome__EYG+2",g="index_text__n9sFM",N="index_search__aa8d8",I="index_searchInputCon__xNmRG",Z="index_searchInput__6iGKS",k="index_empty__Qcy8d",S="index_searchBtn__HcWKq",w="index_main__hwhE4",C="index_serverList__4HtUa",y="index_serverItem__xwvS9",E="index_serverInfo__MIvVl",P="index_avatar__BgoDF",T="index_name__ogqg1",b="index_des__XW78I",R="index_tags__TRtpM",z="index_tag__uD8oq",B="index_tagText__2T5f3",q=t(7411),D=t(3695),F=t(5873),K=t(2570),L=t(5254),M=t(2718),W=t(7459),G=t(4569),O=t.n(G),U=(0,t(9072).Z.getState)().app.userInfo.accessToken;function A(e,n,t){return new Promise((function(s,c){switch(e){case"get":(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((function(t,s){O().get(e,{params:n}).then((function(s){H(e,n,s.data),t(s.data)})).catch((function(e){s(e)}))}))})(n,t).then((function(e){s(e)})).catch((function(e){c(e)}));break;case"post":(function(e,n){return new Promise((function(t,s){O().post(e,n).then((function(e){t(e.data)}),(function(e){s(e)}))}))})(n,t).then((function(e){s(e)})).catch((function(e){c(e)}))}}))}function H(e,n,t){t.code}O().defaults.timeout=1e5,O().interceptors.request.use((function(e){return e.data=JSON.stringify(e.data),e.headers={"Content-Type":"application/json",Authorization:"Bearer ".concat(U)},e}),(function(e){return Promise.reject(e)})),O().interceptors.response.use((function(e){return 2===e.data.errCode&&console.log("\u8fc7\u671f"),e}),(function(e){console.log("\u8bf7\u6c42\u51fa\u9519\uff1a",e)}));var J=t(8406),V=t(8687),X=(0,s.memo)((0,V.$j)((function(e){e.server;return{}}),(function(e){return{setServerRole:function(n){return e({type:"app/setServerRole",payload:n})}}}))((function(e){var n=e.setServerRole,t=(0,c.s0)(),a=(0,s.useRef)(""),r=(0,s.useState)([]),i=(0,v.Z)(r,2),o=i[0],l=i[1],d=(0,s.useState)([]),u=(0,v.Z)(d,2),f=u[0],m=u[1],G=(0,s.useState)(""),O=(0,v.Z)(G,2),U=O[0],H=O[1];(0,s.useEffect)((function(){""===U&&m(o)}),[o,U]),(0,s.useEffect)((function(){var e=q.Z.conn,n=e.apiUrl,t=e.orgName,s=e.appName;A("get","".concat(n,"/").concat(t,"/").concat(s,"/circle/server/recommend/list")).then((function(e){e.servers.length>0&&e.servers.forEach((function(e){e.id=e.server_id,e.tags.forEach((function(e){e.tagId=e.server_tag_id,e.tagName=e.tag_name}))})),l(e.servers)})).catch((function(e){console.log("\u83b7\u53d6\u793e\u533a\u63a8\u8350\u5217\u8868\u5931\u8d25",e)}))}),[]);var V=(0,s.useCallback)((function(){""!==U?q.Z.conn.getServers({keyword:U}).then((function(e){m(e.data.list)})).catch((function(e){console.log("\u6839\u636eServer\u540d\u79f0\u641c\u7d22\u5931\u8d25",e)})):l()}),[U]),X=function(e){var s=e.id||e.server_id,c=e.defaultChannelId||e.default_channel_id;q.Z.conn.isInServer({serverId:s}).then((function(e){if(e.data.result)t("/main/channel/".concat(s,"/").concat(c));else{var a=(0,J.OK)({title:"",okText:"\u7acb\u5373\u52a0\u5165",cancelText:"\u53d6\u6d88",content:(0,x.jsx)(W.Z,{serverId:s,isServerInvite:!0}),onOk:function(){return e=s,void q.Z.conn.joinServer({serverId:e}).then((function(a){console.log("\u52a0\u5165Server\u6210\u529f",a),(0,J.w7)(e,a.data),t("/main/channel/".concat(s,"/").concat(c)),q.Z.conn.getServerRole({serverId:e}).then((function(t){n({serverId:e,role:t.data.role})}))})).catch((function(e){"User is already in server."===e.message?D.ZP.warn({content:"\u5df2\u7ecf\u5728server\u4e86\uff01"}):D.ZP.warn({content:"\u52a0\u5165\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5\uff01"})}));var e},onCancel:function(){console.log("close")}});F.Z.confirm(a)}})).catch((function(){D.ZP.warn({content:"\u67e5\u8be2\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5\uff01"})}))},Y=(0,s.useCallback)((function(e){13===e.keyCode&&(e.preventDefault(),V())}),[V]);return(0,s.useEffect)((function(){return a.current.addEventListener("keydown",Y),function(){var e;a&&(null===a||void 0===a||null===(e=a.current)||void 0===e||e.removeEventListener("keydown",Y))}}),[Y]),(0,x.jsxs)("div",{className:h,children:[(0,x.jsxs)("div",{className:j,children:[(0,x.jsxs)("div",{className:p,children:[(0,x.jsx)("span",{className:g,children:"\u6b22\u8fce\u6765\u5230"}),(0,x.jsx)("span",{className:g,children:"\u73af\u4fe1\u5708\u5b50"})]}),(0,x.jsxs)("div",{className:N,children:[(0,x.jsxs)("div",{className:I,children:[(0,x.jsx)("input",{ref:a,className:Z,placeholder:"\u641c\u7d22\u793e\u533a",value:U,onChange:function(e){H(e.target.value)}}),""!==U&&(0,x.jsx)("span",{className:k,onClick:function(){H("")},children:(0,x.jsx)(_.Z,{name:"xmark_in_circle",size:"20px",color:"#e4e4e4"})})]}),(0,x.jsx)("div",{className:"circleBtn66 circleBtn ".concat(S),onClick:V,children:"\u641c\u7d22"})]})]}),(0,x.jsx)("div",{className:w,children:(0,x.jsx)(K.ZP,{className:C,grid:{gutter:12,xs:2,sm:2,md:2,lg:3,xl:4,xxl:5},dataSource:f,renderItem:function(e){return(0,x.jsx)(K.ZP.Item,{children:(0,x.jsx)(L.Z,{className:"".concat(y),style:{backgroundImage:"url(".concat((0,J.Nt)(e.id),")")},onClick:function(){X(e)},children:(0,x.jsxs)("div",{className:E,children:[(0,x.jsx)("div",{className:P,children:(0,x.jsx)(M.Z,{size:48,isServer:!0,src:e.icon_url})}),(0,x.jsx)("div",{className:T,children:e.name}),(0,x.jsx)("div",{className:b,children:e.description||"\u7fa4\u4e3b\u6709\u70b9\u61d2\uff0c\u5c31\u4e0d\u5199\u4ecb\u7ecd\u3002"}),(0,x.jsx)("div",{className:R,children:e.tags&&e.tags.length>0&&e.tags.map((function(e){return(0,x.jsxs)("div",{className:z,children:[(0,x.jsx)(_.Z,{name:"label",color:"rgba(255,255,255,.74)",size:"12px"}),(0,x.jsx)("span",{className:B,children:e.tagName})]},e.tagId)}))})]})},e.server_id)})}})})]})}))),Y=function(){return(0,x.jsxs)("div",{className:a,children:[(0,x.jsx)(m,{}),(0,x.jsx)(X,{}),(0,x.jsx)(c.j3,{})]})},Q=(0,s.memo)(Y)}}]);
//# sourceMappingURL=887.096bcdae.chunk.js.map