"use strict";(self.webpackChunkcircle=self.webpackChunkcircle||[]).push([[806],{4966:function(e,n,s){s.d(n,{Z:function(){return l}});var i=s(2791),a="index_headerWrap__7KmC+",t=s(184),c=function(e){var n=e.children,s=e.style,i=void 0===s?{}:s;return(0,t.jsx)("div",{className:a,style:i,children:n})},l=(0,i.memo)(c)},4660:function(e,n,s){s.r(n),s.d(n,{default:function(){return R}});var i=s(9439),a=s(2791),t="index_chatWrap__ukSwf",c="index_contentWrap__KYi9g",l="index_messageWrap__26OT7",o="index_iptWrap__qnadS",r="index_main__DsDiT",d={wrap:"index_wrap__XXUmu",left:"index_left__6A8oy",nickName:"index_nickName__fyolt",op:"index_op__SLwEG"},u=s(4966),p=s(2718),h=s(6871),v=s(8687),x=s(1091),f=s(6014),m=s(7411),_=s(184),j=function(){return[{label:(0,_.jsx)("div",{className:d.iconCon,children:(0,_.jsx)(x.Z,{iconClass:d.icon,name:"ellipsis",size:"24px"})}),key:"SubMenu",children:[{label:(0,_.jsxs)("div",{className:d.menuWrap,children:[(0,_.jsx)(x.Z,{name:"trash",size:"16px"}),(0,_.jsx)("span",{children:"\u5220\u9664\u4f1a\u8bdd"})]}),key:"deleteConversation"}]}]},y=(0,a.memo)((0,v.$j)((function(e){var n=e.app,s=e.contact;return{appUserInfo:n.appUserInfo,conversationList:s.conversationList}}),(function(e){return{setConversationList:function(n){return e({type:"contact/setConversationList",payload:n})}}}))((function(e){var n,s,i,a=e.appUserInfo,t=e.conversationList,c=e.setConversationList,l=(0,h.s0)(),o=(0,h.UO)().userId;return(0,_.jsx)(u.Z,{children:(0,_.jsxs)("div",{className:d.wrap,children:[(0,_.jsxs)("div",{className:d.left,children:[(0,_.jsx)(p.Z,{size:36,online:null===(n=a[o])||void 0===n?void 0:n.online,src:null===(s=a[o])||void 0===s?void 0:s.avatarurl}),(0,_.jsx)("span",{className:d.nickName,children:(null===(i=a[o])||void 0===i?void 0:i.nickname)||o})]}),(0,_.jsx)("div",{className:d.op,children:(0,_.jsx)(f.Z,{onClick:function(e){"deleteConversation"===e.key&&m.Z.conn.deleteConversation({channel:o,chatType:"singleChat",deleteRoam:!1}).then((function(){var e=t.indexOf(o);e>-1&&(t.splice(e,1),c(t)),l("/main/contacts/index")}))},style:{padding:0},theme:"dark",selectable:!1,triggerSubMenuAction:"click",mode:"horizontal",items:j()})})]})})}))),g=s(7115),C=s(4760),N=s(7196),Z=s(8406),k=s(7083),b=s(3433),I="index_detailWrap__pWZwQ",L="index_bg__fpU3w",M="index_contactOp__2kk14",w="index_infoCon__3VhOr",S="index_userInfo__vyls5",z="index_avatar__dMLle",O="index_nickname__vPYRn",T="index_idInfo__ffy41",U="index_buttonCon__4CaOh",A="index_private__Tcmzn",D=s(5873),W=s(7382),P=(0,a.memo)((0,v.$j)((function(e){var n=e.app,s=e.contact;return{appUserInfo:n.appUserInfo,contactsList:s.contactsList,hasSentApply:s.hasSentApply}}),(function(e){return{setHasSentApply:function(n){return e({type:"contact/setHasSentApply",payload:n})}}}))((function(e){var n,s,i,a,t,c=e.visible,l=e.userId,o=e.appUserInfo,r=e.contactsList,d=e.hasSentApply,u=e.handleCancel,v=e.setHasSentApply,j=(0,h.s0)(),y=function(){m.Z.conn.addContact(l),v([].concat((0,b.Z)(d),[l]))};return(0,_.jsxs)(D.Z,{visible:c,width:"545px",wrapClassName:I,footer:null,onCancel:u,children:[(0,_.jsx)("div",{className:L,children:r.indexOf(l)>-1&&(0,_.jsx)(W.Z,{overlay:(a=l,t=function(e){m.Z.conn.deleteContact(e)},(0,_.jsx)(f.Z,{onClick:function(){t(a)},items:[{key:"1",label:(0,_.jsxs)("div",{className:"circleDropItem",children:[(0,_.jsx)(x.Z,{name:"trash",size:"22px",iconClass:"circleDropMenuIcon"}),(0,_.jsx)("span",{className:"circleDropMenuOp",children:"\u5220\u9664\u597d\u53cb"})]})}]})),placement:"bottomRight",trigger:["click"],overlayClassName:"circleDropDown",children:(0,_.jsx)("div",{className:M,children:(0,_.jsx)(x.Z,{size:"26px",name:"ellipsis",color:"#fff"})})})}),(0,_.jsxs)("div",{className:w,children:[(0,_.jsxs)("div",{className:S,children:[(0,_.jsx)("div",{className:z,children:(0,_.jsx)(p.Z,{size:90,src:null===(n=o[l])||void 0===n?void 0:n.avatarurl,online:null===(s=o[l])||void 0===s?void 0:s.online})}),(0,_.jsx)("div",{className:O,children:(null===(i=o[l])||void 0===i?void 0:i.nickname)||l}),(0,_.jsxs)("div",{className:T,children:["\u73af\u4fe1ID\uff1a",l]})]}),(0,_.jsxs)("div",{className:U,children:[d.indexOf(l)>-1?(0,_.jsx)("div",{className:"circleBtn152 circleBtnGray disable",children:"\u597d\u53cb\u8bf7\u6c42\u5f85\u786e\u8ba4"}):r.indexOf(l)<0?(0,_.jsx)("div",{className:"circleBtn106 circleBtnGray }",onClick:y,children:"\u52a0\u4e3a\u597d\u53cb"}):void 0,(0,_.jsx)("div",{className:"circleBtn106 circleBtn ".concat(A),onClick:function(){u(),j("/main/contacts/chat/".concat(l))},children:"\u79c1\u804ata"})]})]})]})}))),B=s(4771),R=(0,a.memo)((0,v.$j)((function(e){var n=e.channel,s=e.app,i=e.contact;return{visible:n.channelVisible,chatMap:s.chatMap,showThreadPanel:n.showThreadPanel,conversationList:i.conversationList}}),(function(e){return{setVisible:function(n){return e({type:"channel/setVisible",payload:n})},pushChatMessage:function(n){return e({type:"app/pushChatMessage",payload:n})},handleThreadPanel:function(n){return e({type:"channel/setThreadPanelStatus",payload:n})},setMsgReaction:function(n){return e({type:"app/setMsgReaction",payload:n})},setConversationList:function(n){return e({type:"contact/setConversationList",payload:n})}}}))((function(e){var n,s,d=e.chatMap,u=e.pushChatMessage,p=e.handleThreadPanel,v=e.setMsgReaction,x=e.conversationList,f=e.setConversationList,j=(0,h.UO)().userId,b=(0,a.useMemo)((function(){return d[N.zi.single].get(j)||{}}),[j,d]),I=function(e){var n=e.cursor,s=void 0===n?"":n;m.Z.conn.getHistoryMessages({targetId:j,pageSize:20,chatType:N.zi.single,cursor:s}).then((function(e){e.messages.forEach((function(e){v({msgId:e.id,reactions:e.reactions})})),u({chatType:N.zi.single,fromId:j,messageInfo:{list:e.messages,cursor:e.cursor,loadCount:e.messages.length},reset:!s})}))};(0,a.useEffect)((function(){p(!1),I({cursor:""}),x.indexOf(j)<0&&(x.unshift(j),f(x))}),[j]);var L=(0,a.useState)(!1),M=(0,i.Z)(L,2),w=M[0],S=M[1],z=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2?arguments[2]:void 0;switch(console.log("chat:",e,s),e){case"recall":(0,Z.pe)(s,n);break;case"openUserInfoPanel":s.from!==m.Z.conn.user&&(0,Z.mZ)([s.from]).then((function(){S(!0)}))}};return(0,_.jsxs)("div",{className:t,children:[(0,_.jsxs)("div",{className:r,children:[(0,_.jsx)(y,{}),(0,_.jsxs)("div",{className:c,children:[(0,_.jsx)("div",{id:N.jZ,className:l,children:(0,_.jsx)(B.Z,{inverse:!0,dataLength:(null===b||void 0===b||null===(n=b.list)||void 0===n?void 0:n.length)||0,next:function(){I({cursor:null===b||void 0===b?void 0:b.cursor})},hasMore:(null===b||void 0===b?void 0:b.loadCount)>=20,style:{display:"flex",flexDirection:"column-reverse"},loader:(0,_.jsx)(k.Z,{}),endMessage:(0,_.jsx)("div",{style:{textAlign:"center"},children:"\u6ca1\u6709\u66f4\u591a\u6d88\u606f\u5566\uff5e"}),scrollableTarget:N.jZ,children:null===b||void 0===b||null===(s=b.list)||void 0===s?void 0:s.map((function(e){return(0,_.jsx)("div",{children:(0,_.jsx)(g.Z,{message:e,onHandleOperation:z,source:N.Z5.single})},e.id)}))})}),(0,_.jsx)("div",{className:o,children:(0,_.jsx)(C.Z,{chatType:N.zi.single,fromId:j})})]})]}),(0,_.jsx)(P,{visible:w,userId:j,handleCancel:function(){return S(!1)}})]})})))}}]);
//# sourceMappingURL=806.e0f71a38.chunk.js.map