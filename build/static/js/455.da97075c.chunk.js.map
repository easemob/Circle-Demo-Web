{"version":3,"file":"static/js/455.da97075c.chunk.js","mappings":"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","sources":["webpack://circle/./src/views/Login/login.module.less?b48d","views/Login/login.js","../node_modules/shallowequal/index.js"],"sourcesContent":["// extracted by mini-css-extract-plugin\nexport default {\"loginContainer\":\"login_loginContainer__hNAAS\",\"loginLayout\":\"login_loginLayout__-zivO\",\"loginIcon\":\"login_loginIcon__v0Xrs\",\"loginText\":\"login_loginText__2xzmB\",\"isLogging\":\"login_isLogging__ZGX3K\",\"loginMain\":\"login_loginMain__pVBUC\",\"usernameInput\":\"login_usernameInput__6Wjwe\",\"clearIcon\":\"login_clearIcon__fjKUa\",\"passwordInput\":\"login_passwordInput__ptEgU\",\"eyeIcon\":\"login_eyeIcon__Ioa-0\",\"loginButton\":\"login_loginButton__G+Y7+\",\"loginDisable\":\"login_loginDisable__WDLGT\",\"isLoggingInput\":\"login_isLoggingInput__Bcm6F\",\"agreement\":\"login_agreement__unp1s\",\"agreeText\":\"login_agreeText__Nl0QJ\",\"loginTips\":\"login_loginTips__ZlfRX\",\"link\":\"login_link__+a6GP\",\"defaultIcon\":\"login_defaultIcon__aSM6W\"};","import style from \"./login.module.less\";\nimport { Input, Spin, message } from \"antd\";\nimport { useState, useCallback, memo, useEffect } from \"react\";\nimport { LoadingOutlined } from \"@ant-design/icons\";\nimport { connect } from \"react-redux\";\nimport WebIM from \"@/utils/WebIM\";\nimport { useNavigate } from \"react-router-dom\";\nimport Icon from \"@/components/Icon\";\nimport { LOGIN_PASSWORD } from \"@/consts\";\n\nconst LoadingIcon = () => {\n  return (\n    <LoadingOutlined\n    style={{\n      fontSize: 24,\n      color: \"#fff\"\n    }}\n  />\n  )\n}\n\nconst LOGIN = {\n  loginText: \"登录环信圈子\",\n  usernamePlaceHolder: \"请输入您的手机号\",\n  passwordPlaceHolder: \"请输入密码\",\n  login: \"登录\"\n};\nlet userInfos = JSON.parse(localStorage.getItem(\"userInfo\")) || {};\n\nfunction Login(props) {\n  const {\n    isLogging,\n    loginSuccess,\n    setUserInfo,\n    setLoginStatus,\n    appUserInfo,\n    userInfo,\n    setAppUserInfo\n  } = props;\n\n  let navigate = useNavigate();\n  useEffect(() => {\n    if (loginSuccess && isLogging) {\n      setLoginStatus(false);\n      navigate(\"/main\", { replace: true });\n    }\n  }, [isLogging, loginSuccess, navigate, setLoginStatus]);\n  const [inputValue, setInputValue] = useState(\n    Object.assign(\n      {\n        username: \"\",\n        password: \"\",\n        agree: false\n      },\n      userInfos\n    )\n  );\n  const handleInputChange = (prop) => (event) => {\n    let value = event.target.value;\n    if (prop === \"username\") {\n      value = value.replace(/[^\\d]/g, \"\");\n    } else if (prop === \"agree\") {\n      value = !inputValue.agree;\n    }\n    setInputValue({ ...inputValue, [prop]: value });\n  };\n\n  //login\n  const login = useCallback(() => {\n    //校验用户输入\n    if (inputValue.username === \"\") return;\n    if (!inputValue.username) {\n      // !inputValue.password ||\n      // inputValue.password.replace(/(^\\s*)|(\\s*$)/g, \"\") === \"\"\n      message.warn({ content: \"请输入用户名！\" });\n      return;\n    } else if (!/^1\\d{10}$/.test(inputValue.username)) {\n      message.warn({ content: \"请输入合法手机号！\" });\n      return;\n    } else if (!inputValue.agree) {\n      message.warn({\n        content: (\n          <span>\n            体验本Demo您需要同意\n            <a\n              target=\"_blank\"\n              href=\"https://www.easemob.com/terms/im\"\n              rel=\"noreferrer\"\n            >\n              《环信服务条款》\n            </a>\n            与\n            <a\n              target=\"_blank\"\n              href=\"https://www.easemob.com/protocol\"\n              rel=\"noreferrer\"\n            >\n              《环信隐私协议》\n            </a>\n            。\n          </span>\n        )\n      });\n      return;\n    }\n    WebIM.conn\n      .open({\n        user: inputValue.username,\n        pwd: LOGIN_PASSWORD\n      })\n      .then((res) => {\n        const { accessToken } = res;\n        const userInfos = {\n          username: inputValue.username,\n          accessToken,\n          agree: true\n        };\n        //本地存储用户信息，下次登录自动填充\n        localStorage.setItem(\"userInfo\", JSON.stringify(userInfos));\n        //store存储用户信息\n        setUserInfo(userInfos);\n        setLoginStatus(true);\n        //销毁提示信息\n        message.destroy();\n        WebIM.conn.fetchUserInfoById(inputValue.username).then((res) => {\n          const resInfo = { ...res.data[inputValue.username] };\n          const info = { ...userInfos, ...resInfo };\n          setUserInfo(info);\n          localStorage.setItem(\"userInfo\", JSON.stringify(info));\n          const dl = { ...resInfo, uid: inputValue.username };\n          setAppUserInfo({ ...appUserInfo, [inputValue.username]: dl });\n        });\n      })\n      .catch((err) => {\n        console.log(err, \"err\");\n        const errInfo = err.data?.data ? JSON.parse(err.data.data) : \"\";\n        if (errInfo.error_description === \"user not found\") {\n          WebIM.conn\n            .registerUser({\n              username: inputValue.username,\n              password: LOGIN_PASSWORD\n            })\n            .then((res) => {\n              login();\n            })\n            .catch((e) => {\n              setLoginStatus(false);\n              message.warn({ content: \"注册失败，请重试！\" });\n            });\n        } else {\n          setLoginStatus(false);\n          message.warn({ content: \"用户名或密码错误！\" });\n        }\n      });\n  }, [\n    inputValue.username,\n    inputValue.agree,\n    setLoginStatus,\n    setUserInfo,\n    setAppUserInfo,\n    appUserInfo\n  ]);\n\n  useEffect(() => {\n    if (userInfo) {\n      window.location = \"/\";\n    }\n  }, []);\n  return (\n    <div className={style.loginContainer}>\n      <div className={style.loginLayout}>\n        <div className={style.loginIcon}></div>\n        <div className={style.loginText}>{LOGIN.loginText}</div>\n        <div className={style.loginMain}>\n          <Input\n            disabled={isLogging}\n            value={inputValue.username}\n            className={`${style.usernameInput} ${isLogging ? style.isLoggingInput : null\n              }`}\n            placeholder={LOGIN.usernamePlaceHolder}\n            allowClear={{\n              clearIcon: (\n                <Icon name=\"xmark_in_circle\" color=\"#979797\" size=\"22px\"></Icon>\n              )\n            }}\n            maxLength={11}\n            onChange={handleInputChange(\"username\")}\n          />\n          {/* <form>\n            <Input.Password\n              disabled={isLogging}\n              autoComplete=\"on\"\n              value={inputValue.password}\n              className={`${style.passwordInput} ${isLogging ? style.isLoggingInput : null\n                }`}\n              placeholder={LOGIN.passwordPlaceHolder}\n              iconRender={(visible) => (visible ? <span className={style.eyeIcon}><Icon name=\"eye\" size=\"24px\" color=\"#979797\" iconClass={style.eyeIcon} /></span> : <span><Icon name=\"eye_slash\" size=\"24px\" color=\"#979797\" iconClass={style.eyeIcon} /></span>)}\n              onChange={handleInputChange(\"password\")}\n            />\n          </form> */}\n          <div\n            className={`${style.loginButton} ${inputValue.username === \"\" ? style.loginDisable : null\n              }`}\n            onClick={login}\n          >\n            {!isLogging ? (\n              <span>{LOGIN.login}</span>\n            ) : (\n              <Spin indicator={<LoadingIcon />}/>\n            )}\n          </div>\n        </div>\n        <div\n          className={`${style.agreement} ${isLogging ? style.isLogging : null}`}\n        >\n          <p className={style.agreeText}>\n            <span\n              className={`${style.defaultIcon}`}\n              onClick={handleInputChange(\"agree\")}\n            >\n              {inputValue.agree ? (\n                <Icon name=\"check_in_circle\" size=\"22px\" color=\"#16D265\" />\n              ) : (\n                <Icon name=\"circle\" size=\"22px\" color=\"#979797\" />\n              )}\n            </span>\n            同意\n            <a\n              className={style.link}\n              target=\"_blank\"\n              href=\"https://www.easemob.com/terms/im\"\n              rel=\"noreferrer\"\n            >\n              《环信服务条款》\n            </a>\n            与\n            <a\n              className={style.link}\n              target=\"_blank\"\n              href=\"https://www.easemob.com/protocol\"\n              rel=\"noreferrer\"\n            >\n              《环信隐私协议》\n            </a>\n            ，\n          </p>\n          <p className={style.loginTips}>未注册手机号登陆成功后将自动注册。</p>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nconst mapStateToProps = ({ app }) => {\n  return {\n    isLogging: app.isLogging,\n    loginSuccess: app.loginSuccess,\n    appUserInfo: app.appUserInfo,\n    userInfo: app.userInfo\n  };\n};\n\nconst mapDispatchToProps = (dispatch) => {\n  return {\n    setLoginStatus: (params) => {\n      return dispatch({\n        type: \"app/setLoginStatus\",\n        payload: params\n      });\n    },\n    setUserInfo: (params) => {\n      return dispatch({\n        type: \"app/setUserInfo\",\n        payload: params\n      });\n    },\n    setAppUserInfo: (params) => {\n      return dispatch({\n        type: \"app/setAppUserInfo\",\n        payload: params\n      });\n    }\n  };\n};\nexport default memo(connect(mapStateToProps, mapDispatchToProps)(Login));\n","//\n\nmodule.exports = function shallowEqual(objA, objB, compare, compareContext) {\n  var ret = compare ? compare.call(compareContext, objA, objB) : void 0;\n\n  if (ret !== void 0) {\n    return !!ret;\n  }\n\n  if (objA === objB) {\n    return true;\n  }\n\n  if (typeof objA !== \"object\" || !objA || typeof objB !== \"object\" || !objB) {\n    return false;\n  }\n\n  var keysA = Object.keys(objA);\n  var keysB = Object.keys(objB);\n\n  if (keysA.length !== keysB.length) {\n    return false;\n  }\n\n  var bHasOwnProperty = Object.prototype.hasOwnProperty.bind(objB);\n\n  // Test for A's keys different from B.\n  for (var idx = 0; idx < keysA.length; idx++) {\n    var key = keysA[idx];\n\n    if (!bHasOwnProperty(key)) {\n      return false;\n    }\n\n    var valueA = objA[key];\n    var valueB = objB[key];\n\n    ret = compare ? compare.call(compareContext, valueA, valueB, key) : void 0;\n\n    if (ret === false || (ret === void 0 && valueA !== valueB)) {\n      return false;\n    }\n  }\n\n  return true;\n};\n"],"names":["LoadingIcon","LoadingOutlined","style","fontSize","color","LOGIN","userInfos","JSON","parse","localStorage","getItem","memo","connect","app","isLogging","loginSuccess","appUserInfo","userInfo","dispatch","setLoginStatus","params","type","payload","setUserInfo","setAppUserInfo","props","navigate","useNavigate","useEffect","replace","useState","Object","assign","username","password","agree","inputValue","setInputValue","handleInputChange","prop","event","value","target","login","useCallback","test","WebIM","user","pwd","LOGIN_PASSWORD","then","res","accessToken","setItem","stringify","message","resInfo","data","info","dl","uid","catch","err","console","log","error_description","e","content","href","rel","window","location","className","disabled","placeholder","allowClear","clearIcon","Icon","name","size","maxLength","onChange","onClick","indicator","module","exports","objA","objB","compare","compareContext","ret","call","keysA","keys","keysB","length","bHasOwnProperty","prototype","hasOwnProperty","bind","idx","key","valueA","valueB"],"sourceRoot":""}