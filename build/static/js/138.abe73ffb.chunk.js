"use strict";(self.webpackChunkcircle=self.webpackChunkcircle||[]).push([[138,982],{1269:function(e,n,a){a.d(n,{Z:function(){return u}});var r="index_info__ZJIn6",i="index_defaultStyle__+aVsA",s="index_name__DW1g1",t="index_all__JUGKz",c="index_online__pBQbe",d="index_offline__nm8iG",l=a(2791),o=a(184),h=function(e){var n=e.online,a=e.name,l=e.showOnline;return(0,o.jsxs)("div",{className:r,children:[(0,o.jsx)("span",{className:"".concat(i," ").concat(l?s:t),children:a}),l&&(0,o.jsx)("span",{className:"".concat(c," ").concat(n?null:d),children:n?"\u5728\u7ebf":"\u79bb\u7ebf"})]})},u=(0,l.memo)(h)},8967:function(e,n,a){a.d(n,{Z:function(){return d}});var r=a(2791),i=a(1091),s="index_close__A4OxI",t=a(184),c=function(){return(0,t.jsx)("span",{className:s,children:(0,t.jsx)(i.Z,{name:"xmark",color:"#C7C7C7",size:"18px"})})},d=(0,r.memo)(c)},149:function(e,n,a){a.d(n,{Z:function(){return v}});var r=a(9439),i=a(1269),s=a(2718),t="index_contactsItem__td4Mf",c="index_selected__gwyZ5",d="index_contactsItem2__cp+N3",l="index_mainInfo__5wuox",o="index_avatar__jTpQV",h="index_type2__rGTXq",u="index_basicInfo__B8XcK",_="index_operation__-G2DM",m=a(2791),f=a(184),x=function(e){var n=e.info,a=e.uid,x=e.operationReactNode,v=e.handlerHover,p=e.borderType,j=e.basicShowOnline,N=e.size,T=(0,m.useRef)(),g=(0,m.useState)(!1),I=(0,r.Z)(g,2),Z=I[0],C=I[1];return(0,m.useEffect)((function(){var e=function(e){var n=T.current;n&&(n.contains(e.target)?C(!0):C(!1))};return document.addEventListener("click",e),function(){document.removeEventListener("click",e)}}),[]),(0,f.jsxs)("div",{className:"memberItem ".concat(t," ").concat(Z?c:2===p?d:null," "),onMouseOver:function(){v&&v(null===n||void 0===n?void 0:n.uid)},onMouseLeave:function(){v&&v("")},children:[(0,f.jsx)("div",{className:o,children:(0,f.jsx)(s.Z,{size:N,name:(null===n||void 0===n?void 0:n.nickname)||a,src:null===n||void 0===n?void 0:n.avatarurl,online:null===n||void 0===n?void 0:n.online})}),(0,f.jsxs)("div",{className:"".concat(l," ").concat(2===p?h:null),children:[(0,f.jsx)("div",{className:u,children:(0,f.jsx)(i.Z,{name:(null===n||void 0===n?void 0:n.nickname)||a,src:null===n||void 0===n?void 0:n.avatarurl,online:null===n||void 0===n?void 0:n.online,showOnline:j})}),(0,f.jsx)("div",{className:_,ref:T,children:x})]})]})},v=(0,m.memo)(x)},1982:function(e,n,a){a.r(n),a.d(n,{default:function(){return Ze}});var r=a(9439),i=a(2791),s=a(4164),t="index_layout__kBiDQ",c="index_contentWrap__QMLvx",d="index_messageWrap__4vhxX",l="index_messageItem__3agRj",o="index_iptWrap__NMNuC",h=a(1413),u="index_layout__tzeXz",_="index_close__MF9VT",m="index_createCon__MElwt",f="index_threadBar__uw1FD",x="index_nameCon__Ncr-N",v="index_channelInfo__26U8h",p="index_line__tM0mm",j="index_iconCon__XUjIF",N="index_name__llrZI",T="index_threadInfo__E8D0D",g="index_editIcon__nm0Fa",I="index_threadMember__yjLIx",Z="index_updateNickname__dBUyN",C="index_title__C-4j3",y="index_updateCon__Tf7k7",b="index_input__tiIki",M="index_count__Ro5mN",k="index_confirm__ZxHyb",w="index_logoutCon__HrMXM",S="index_content__0I6Sx",O="index_buttons__4zZOm",z="index_membersCon__AR6wD",D=a(1091),E=a(3695),P=a(7382),B=a(3020),H=a(5873),R=a(6014),L=a(184),U={threadMember:{id:"threadMember",name:"\u5b50\u533a\u6210\u5458",iconName:"person_2"},editThread:{id:"editThread",name:"\u7f16\u8f91\u5b50\u533a",iconName:"gear"},leaveThread:{id:"leaveThread",name:"\u9000\u51fa\u5b50\u533a",iconName:"door"},destroyThread:{id:"destroyThread",name:"\u5220\u9664\u5b50\u533a",iconName:"trash"}},F=function(e,n){var a=[];return e.forEach((function(e){a.push({key:e,label:(0,L.jsxs)("div",{className:"circleDropItem",children:[(0,L.jsx)(D.Z,{name:U[e].iconName,size:"22px",iconClass:"circleDropMenuIcon"}),(0,L.jsx)("span",{className:"circleDropMenuOp",children:U[e].name})]})})})),(0,L.jsx)(R.Z,{items:a,onClick:n})},G=a(3433),X={layout:"index_layout__Nq0mB",header:"index_header__y0pgN",title:"index_title__aOSmL",close:"index_close__R1V3P",container:"index_container__p7hc2"},Q=a(149),V=a(8687),W=a(4771),$=a(7411),A=a(8406),J=a(8967),q="threadMemberScrollId",K=(0,i.memo)((0,V.$j)((function(e){var n=e.app,a=e.thread;return{appUserInfo:n.appUserInfo,currentThreadInfo:a.currentThreadInfo}}),null)((function(e){var n=e.close,a=e.appUserInfo,s=e.currentThreadInfo,t=e.visible,c=(0,i.useState)([]),d=(0,r.Z)(c,2),l=d[0],o=d[1],h=(0,i.useState)(!0),u=(0,r.Z)(h,2),_=u[0],m=u[1],f=(0,i.useState)(""),x=(0,r.Z)(f,2),v=x[0],p=x[1],j=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";e&&$.Z.conn.getChatThreadMembers({chatThreadId:e,cursor:n,pageSize:20}).then((function(e){p(e.properties.cursor),(0,A.mZ)(e.data.affiliations).then((function(){e.data.affiliations.length<20?m(!1):m(!0),o(""===n?e.data.affiliations:[].concat((0,G.Z)(l),(0,G.Z)(e.data.affiliations)))}))}))};return(0,i.useEffect)((function(){t?j(null===s||void 0===s?void 0:s.id):p("")}),[t]),(0,L.jsxs)("div",{className:X.layout,children:[(0,L.jsxs)("div",{className:X.header,children:[(0,L.jsx)("span",{className:X.title,children:"\u5b50\u533a\u6210\u5458"}),(0,L.jsx)("span",{onClick:n,className:X.closeIcon,children:(0,L.jsx)(J.Z,{})})]}),(0,L.jsx)("div",{id:q,className:X.container,children:(0,L.jsx)(W.Z,{dataLength:l.length||0,next:function(){j(null===s||void 0===s?void 0:s.id,v)},hasMore:_,loader:(0,L.jsx)(L.Fragment,{}),endMessage:(0,L.jsx)(L.Fragment,{}),scrollableTarget:q,children:(null===l||void 0===l?void 0:l.length)>0&&l.map((function(e,n){return(0,L.jsx)(Q.Z,{size:36,info:a[e],showLine:!0,basicShowOnline:!1,uid:e,borderType:2},n)}))})})]})}))),Y=a(6871),ee=a(7196),ne=(0,i.memo)((0,V.$j)((function(e){var n=e.app,a=e.thread;return{serverRole:n.serverRole,channelInfo:n.currentChannelInfo,currentThreadInfo:a.currentThreadInfo,isCreatingThread:a.isCreatingThread}}),(function(e){return{handleThreadPanel:function(n){return e({type:"thread/setThreadPanelStatus",payload:n})},setThreadInfo:function(n){return e({type:"thread/setThreadInfo",payload:n})},setChannelInfo:function(n){return e({type:"app/setCurrentChannelInfo",payload:n})}}}))((function(e){var n=(0,Y.s0)(),a=e.isCreatingThread,s=e.currentThreadInfo,t=e.handleThreadPanel,c=e.serverRole,d=e.setThreadInfo,l=e.channelInfo,o=e.setChannelInfo,R=(0,Y.UO)(),U=R.serverId,G=R.channelId,X=R.threadId,Q=c[U],V=function(e){switch(e.key){case"threadMember":re(!0);break;case"editThread":de("editThread");break;case"leaveThread":de("leaveThread");break;case"destroyThread":de("destroyThread")}},W=(0,i.useState)(!1),q=(0,r.Z)(W,2),ne=q[0],ae=q[1],re=function(e){ae(e)},ie=(0,i.useState)(""),se=(0,r.Z)(ie,2),te=se[0],ce=se[1],de=function(e){ce(e),"editThread"===e&&me(s.name)},le=function(){switch(te){case"editThread":if(""===_e)return;$.Z.conn.changeChatThreadName({chatThreadId:s.id,name:_e}).then((function(e){me("")})).catch((function(e){E.ZP.warn({content:"\u540d\u79f0\u7f16\u8f91\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5\uff01"})}));break;case"leaveThread":$.Z.conn.leaveChatThread({chatThreadId:s.id}).then((function(){d({}),t(!1),X&&n("/main/channel/".concat(U,"/").concat(G))})).catch((function(e){E.ZP.warn({content:"\u79bb\u5f00\u5b50\u533a\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5\uff01"})}));break;case"destroyThread":$.Z.conn.destroyChatThread({chatThreadId:s.id}).then((function(){(0,A.Ns)(G,s.id).then((function(){d({}),t(!1),X&&n("/main/channel/".concat(U,"/").concat(G))}))})).catch((function(e){E.ZP.warn({content:"\u5220\u9664\u5b50\u533a\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5\uff01"})}))}ce("")},oe=function(){ce("")},he=(0,i.useState)(""),ue=(0,r.Z)(he,2),_e=ue[0],me=ue[1];(0,i.useEffect)((function(){!function(e){var n=e.serverId,a=e.channelId;$.Z.conn.getChannelDetail({serverId:n,channelId:a}).then((function(e){o(e.data)}))}({serverId:U,channelId:G})}),[G,U]);(0,i.useEffect)((function(){var e;X&&(e=X,$.Z.conn.getChatThreadDetail({chatThreadId:e}).then((function(e){var n=(0,A.rS)(e.data.parentId,e.data.messageId),a=n?(0,h.Z)((0,h.Z)({},n),{},{chatThreadOverview:{}}):{};d((0,h.Z)((0,h.Z)({},e.data),{},{parentMessage:a}))})))}),[]);var fe=(0,i.createRef)();return(0,i.useEffect)((function(){te&&"editThread"===te&&setTimeout((function(){fe&&fe.current.focus()}),500)}),[te]),(0,L.jsxs)("div",{className:u,children:[a?(0,L.jsx)("div",{className:m,children:"\u521b\u5efa\u5b50\u533a"}):(0,L.jsxs)("div",{className:f,children:[(0,L.jsxs)("div",{className:x,children:[X&&(0,L.jsxs)("div",{className:v,onClick:function(){n("/main/channel/".concat(U,"/").concat(G));var e=(0,h.Z)({},s);setTimeout((function(){d(e),t(!0)}),500)},children:[(0,L.jsx)("span",{className:j,children:(0,L.jsx)(D.Z,{name:null!==l&&void 0!==l&&l.isPublic?"hashtag":"hashtag_lock",size:"26px",color:"rgba(255, 255, 255, 0.74)"})}),(0,L.jsx)("span",{className:N,children:null===l||void 0===l?void 0:l.name}),(0,L.jsx)("hr",{className:p})]}),(0,L.jsxs)("div",{className:T,children:[(0,L.jsx)("span",{className:j,children:(0,L.jsx)(D.Z,{name:"hashtag_message",size:"26px",color:X?"#fff":"rgba(255, 255, 255, 0.74)"})}),(0,L.jsx)("span",{className:N,children:null===s||void 0===s?void 0:s.name})]})]}),(0,L.jsx)(P.Z,{overlay:function(e){var n=[];switch(e){case ee.N1.owner:n=["threadMember","editThread","leaveThread","destroyThread"];break;case ee.N1.moderator:case ee.N1.user:n=["threadMember","leaveThread"]}return(null===s||void 0===s?void 0:s.owner)===$.Z.conn.user&&e!==ee.N1.owner&&(n=["threadMember","editThread","leaveThread"]),F(n,V)}(Q),placement:"bottomLeft",trigger:["click"],overlayClassName:"circleDropDown",children:(0,L.jsx)("div",{className:g,children:(0,L.jsx)(D.Z,{name:"ellipsis",size:"22px",color:"rgba(255, 255, 255, 0.74)"})})})]}),!X&&(0,L.jsx)("span",{className:_,onClick:function(){t(!1),d({})},children:(0,L.jsx)(D.Z,{name:"xmark",size:"18px",color:"rgba(255, 255, 255, 0.74)"})}),(0,L.jsx)("div",{className:z,children:(0,L.jsx)(B.Z,{content:(0,L.jsx)(K,{close:function(){ae(!1)},visible:ne}),placement:"bottomRight",trigger:"click",visible:ne,onVisibleChange:re,overlayClassName:I})}),(0,L.jsx)(H.Z,{className:"userInfoModal",destroyOnClose:!0,title:"\u7f16\u8f91\u5b50\u533a",visible:"editThread"===te,onCancel:oe,footer:null,closeIcon:(0,L.jsx)(J.Z,{}),children:(0,L.jsxs)("div",{className:Z,children:[(0,L.jsx)("span",{className:C,children:"\u5b50\u533a\u540d\u79f0"}),(0,L.jsxs)("div",{className:y,children:[(0,L.jsx)("input",{ref:fe,className:b,value:_e,maxLength:64,onChange:function(e){return function(e){me(e.target.value)}(e)},placeholder:null===s||void 0===s?void 0:s.name}),(0,L.jsxs)("span",{className:M,children:[_e.length,"/64"]})]}),(0,L.jsx)("div",{className:"circleBtn circleBtn106 ".concat(k," ").concat(""===_e?"disable":null),onClick:le,children:"\u786e\u8ba4"})]})}),(0,L.jsx)(H.Z,{className:"logoutModal",title:"leaveThread"===te?"\u9000\u51fa\u5b50\u533a":"\u5220\u9664\u5b50\u533a",width:546,destroyOnClose:!0,visible:"leaveThread"===te||"destroyThread"===te,onCancel:oe,footer:null,closeIcon:(0,L.jsx)(J.Z,{}),children:(0,L.jsxs)("div",{className:w,children:["leaveThread"===te?(0,L.jsxs)("span",{className:S,children:["\u786e\u8ba4\u9000\u51fa\u5b50\u533a",(0,L.jsxs)("span",{className:N,children:["\xa0",null===s||void 0===s?void 0:s.name]})]}):(0,L.jsxs)("span",{className:S,children:["\u786e\u8ba4\u5220\u9664\u5b50\u533a",(0,L.jsxs)("span",{className:N,children:[null===s||void 0===s?void 0:s.name,"\uff1f"]}),"\u672c\u64cd\u4f5c\u4e0d\u53ef\u6062\u590d\u3002"]}),(0,L.jsxs)("div",{className:O,children:[(0,L.jsx)("div",{className:"circleBtn106 circleBtnGray",onClick:oe,children:"\u53d6\u6d88"}),(0,L.jsx)("div",{className:"circleBtn106 circleBtn ".concat(k),onClick:le,children:"\u786e\u8ba4"})]})]})})]})}))),ae="index_layout__QOryQ",re="index_nameCon__u+-50",ie="index_icon1__rWG6l",se="index_name__Dt9lU",te="index_inputCon__TwESK",ce="index_t__dWsGP",de="index_input__OA5EM",le="index_del__nHuqx",oe="index_b__+TCo-",he="index_light__hR1bJ",ue=(0,i.memo)((0,V.$j)((function(e){e.channel;var n=e.thread;return{currentThreadInfo:n.currentThreadInfo,isCreatingThread:n.isCreatingThread}}),(function(e){return{handleThreadPanel:function(n){return e({type:"thread/setThreadPanelStatus",payload:n})}}}))((function(e){var n=e.isCreatingThread,a=e.currentThreadInfo,s=e.setName,t=(0,i.useRef)(),c=(0,i.useState)(n?"":null===a||void 0===a?void 0:a.name),d=(0,r.Z)(c,2),l=d[0],o=d[1];return(0,i.useEffect)((function(){n&&""===l&&t.current&&t.current.focus()}),[l,n]),(0,i.useEffect)((function(){o((null===a||void 0===a?void 0:a.name)||"")}),[a]),(0,L.jsx)("div",{className:ae,children:n?(0,L.jsxs)("div",{className:te,children:[(0,L.jsxs)("div",{className:ce,children:[(0,L.jsx)("input",{ref:t,maxLength:"64",className:de,placeholder:"\u5b50\u533a\u540d\uff08\u5fc5\u586b\u9879\uff09",value:l,onChange:function(e){o(e.target.value),s(e.target.value)}}),0!==l.length&&(0,L.jsx)("span",{className:le,onClick:function(){o(""),s("")},children:(0,L.jsx)(D.Z,{name:"xmark_in_circle",size:"20px",color:"#666"})})]}),(0,L.jsx)("div",{className:"".concat(oe," ").concat(""!==l?he:""),children:"\u53d1\u9001\u4e00\u6761\u6d88\u606f\u521b\u5efa\u5b50\u533a"})]}):(0,L.jsxs)("div",{className:re,children:[(0,L.jsx)("span",{className:ie,children:(0,L.jsx)(D.Z,{name:"hashtag_message",size:"26px",color:"#fff"})}),(0,L.jsx)("span",{className:se,children:null===a||void 0===a?void 0:a.name})]})})}))),_e="index_layout__0FLyk",me="index_owner__-hu1V",fe="index_messageCon__ovo-7",xe="index_up__80Zv4",ve="index_noMsg__B4Osv",pe="index_lineCon__ncljd",je="index_line__mXNBt",Ne=a(7115),Te=(0,i.memo)((0,V.$j)((function(e){var n=e.app,a=(e.channel,e.thread);return{currentThreadInfo:a.currentThreadInfo,isCreatingThread:a.isCreatingThread,appUserInfo:n.appUserInfo}}),(function(e){return{handleThreadPanel:function(n){return e({type:"thread/setThreadPanelStatus",payload:n})}}}))((function(e){var n=e.isCreatingThread,a=e.currentThreadInfo,r=e.appUserInfo,i=function(e){var n;return null!==(n=r[e])&&void 0!==n&&n.nickname?r[e].nickname:e};return(0,L.jsxs)("div",{className:_e,children:[(0,L.jsxs)("div",{className:me,children:["\u521b\u5efa\u8005\uff1a",i(n?$.Z.conn.user:a.owner)]}),a.parentMessage&&"{}"!==JSON.stringify(a.parentMessage)?(0,L.jsxs)("div",{className:fe,children:[(0,L.jsx)(Ne.Z,{message:a.parentMessage,source:ee.Z5.threadParentMsg}),(0,L.jsx)("span",{className:xe,children:"\u4ee5\u4e0a\u4e3a\u539f\u59cb\u6d88\u606f"})]}):(0,L.jsx)("div",{className:ve,children:"\u62b1\u6b49\uff0c\u65e0\u6cd5\u52a0\u8f7d\u539f\u59cb\u6d88\u606f"}),(0,L.jsx)("div",{className:pe,children:(0,L.jsx)("hr",{className:je})})]})}))),ge=a(4760),Ie="threadMessageScrollId",Ze=(0,i.memo)((0,V.$j)((function(e){var n=e.thread;return{threadCursor:n.threadCursor,threadMessage:n.threadMessage,threadHasHistory:n.threadHasHistory,currentThreadInfo:n.currentThreadInfo}}),(function(e){return{handleThreadPanel:function(n){return e({type:"thread/setThreadPanelStatus",payload:n})}}}))((function(e){var n=e.threadMessage,a=e.threadHasHistory,h=e.currentThreadInfo,u=(0,Y.UO)().channelId,_=(0,i.useState)(""),m=(0,r.Z)(_,2),f=m[0],x=m[1],v=(0,i.useMemo)((function(){return null!==h&&void 0!==h&&h.id&&n.get(h.id)?n.get(h.id):[]}),[h,n]);(0,i.useEffect)((function(){if(h&&null!==h&&void 0!==h&&h.id){x("");var e=p.current;if(!s.findDOMNode(e))return;e.scrollTop=0}null!==h&&void 0!==h&&h.id&&"notify"!==h.source&&(0,A.dj)(h.id)}),[null===h||void 0===h?void 0:h.id]);var p=(0,i.useRef)(null);(0,i.useEffect)((function(){var e=p.current;s.findDOMNode(e)&&!1===a&&0!==v.length&&e.scrollHeight>=e.scrollTop+e.clientHeight&&setTimeout((function(){e.scrollTop=e.scrollHeight}),300)}),[v.length]);var j=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2?arguments[2]:void 0;if("recall"===e)(0,A.pe)(a,n)};return(0,L.jsxs)("div",{className:t,children:[(0,L.jsx)(ne,{}),(0,L.jsxs)("div",{className:c,children:[(0,L.jsx)("div",{id:Ie,className:d,ref:p,children:(0,L.jsxs)(W.Z,{dataLength:v.length||0,next:function(){(0,A.dj)(h.id,!0)},hasMore:a,loader:(0,L.jsx)(L.Fragment,{}),endMessage:(0,L.jsx)(L.Fragment,{}),scrollableTarget:Ie,children:[(0,L.jsx)(ue,{setName:function(e){x(e)}}),(0,L.jsx)(Te,{}),v&&v.length>0&&v.map((function(e){return(0,L.jsx)("div",{className:l,children:(0,L.jsx)(Ne.Z,{message:e,isThreadMessage:!0,parentId:u,source:ee.Z5.threadChat,onHandleOperation:j})},e.id)}))]})}),(0,L.jsx)("div",{className:o,children:(0,L.jsx)(ge.Z,{chatType:ee.zi.groupChat,isThread:!0,fromId:u,threadName:f})})]})]})})))}}]);
//# sourceMappingURL=138.abe73ffb.chunk.js.map